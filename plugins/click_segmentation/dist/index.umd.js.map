{"version":3,"file":"index.umd.js","sources":["../src/ClickSegmentation.tsx","../src/ClickSegmentationPlugin.tsx"],"sourcesContent":["import {\n  executeOperator,\n} from \"@fiftyone/operators\";\nimport * as fos from \"@fiftyone/state\";\nimport _ from \"lodash\";\nimport { useRecoilValue } from \"recoil\";\nimport styled from \"styled-components\";\nimport { useState, useRef, useCallback, useEffect } from \"react\";\n\nexport function ClickSegmentation() {\n  const modalSample = useRecoilValue(fos.modalSample);\n  const [clicks, setClicks] = useState([]);\n  const [isCapturing, setIsCapturing] = useState(false);\n  const [isNegativeClick, setIsNegativeClick] = useState(false);\n  const [isSingleClick, setSingleClick] = useState(false);\n  const [keypointFieldName, setKeypointFieldName] = useState(\"user_clicks\");\n  const [segFieldName, setSegFieldName] = useState(\"\");\n  const [modelName, setModelName] = useState(\"segment-anything-2-hiera-tiny-image-torch\");\n  const [labelName, setLabelName] = useState(\"label\");\n  const markersRef = useRef<HTMLElement[]>([]);\n\n  useEffect(() => {\n    if (!modalSample) return;\n    const metadata = modalSample.sample.metadata;\n  \n    if (!metadata || !metadata.width || !metadata.height) {\n      console.log(\"Sample metadata not available. Computing metadata\");\n      \n      executeOperator(\n        \"@51labs/click_segmentation/compute_metadata\", {}\n      ).catch((error) => {\n        console.error(\"Failed to compute metadata:\", error);\n      });\n    }\n  }, [modalSample?.sample?._id]);\n\n  useEffect(() => {\n    if (!isCapturing || !modalSample) return;\n\n    const handleCanvasClick = async (event: MouseEvent) => {\n      const canvas = event.target as HTMLCanvasElement;\n      if (canvas.tagName !== \"CANVAS\") return;\n      event.stopPropagation();\n      event.preventDefault();\n\n      const rect = canvas.getBoundingClientRect();\n      const metadata = modalSample.sample.metadata;\n\n      if (!metadata || !metadata.width || !metadata.height) {\n        alert(\"Sample metadata not yet available. Reload/refresh the sample modal.\");\n        return\n      }\n      // Calculate the relative position of the click\n      // NOTE: Sample modal displays the image in contain mode filling one dimension while keeping the aspect\n      // ratio. It is possible to zoom in and out in the model which will break the correct image coord capture.\n      // TODO: Fix this for when image width and height are both smaller than that of modal canvas.\n      const imageAspect = metadata.width / metadata.height;\n      const canvasAspect = rect.width / rect.height;\n    \n      let imgWidth, imgHeight, imgOffsetX, imgOffsetY;\n\n      if (imageAspect > canvasAspect) {\n        // Image fills width only\n        imgWidth = rect.width;\n        imgHeight = rect.width / imageAspect;\n        imgOffsetX = 0;\n        imgOffsetY = (rect.height - imgHeight) / 2;\n      } else {\n        // Image fills height\n        imgHeight = rect.height;\n        imgWidth = rect.height * imageAspect;\n        imgOffsetX = (rect.width - imgWidth) / 2;\n        imgOffsetY = 0;\n      }\n    \n      const canvasX = event.clientX - rect.left;\n      const canvasY = event.clientY - rect.top;\n      const imgX = canvasX - imgOffsetX;\n      const imgY = canvasY - imgOffsetY;\n\n      if (imgX < 0 || imgX > imgWidth || imgY < 0 || imgY > imgHeight) {\n        console.log(\"Click outside image bounds\");\n        return;\n      }\n    \n      const normalizedX = imgX / imgWidth;\n      const normalizedY = imgY / imgHeight;\n      const clickData = {\n        normalizedX: parseFloat(normalizedX.toFixed(4)),\n        normalizedY: parseFloat(normalizedY.toFixed(4)),\n        label: isNegativeClick ? 0 : 1\n      };\n    \n      console.log(\"Click captured:\", clickData);\n      showClickMarker(event.clientX, event.clientY);\n\n      if (isSingleClick) {\n        await autoSegmentWithSingleKeypoint(clickData);\n      } else {\n        setClicks((prev) => [...prev, clickData]);\n      }\n    };\n\n    document.addEventListener(\"click\", handleCanvasClick, true);\n    return () => document.removeEventListener(\"click\", handleCanvasClick, true);\n  }, [isCapturing, modalSample, isSingleClick, isNegativeClick, modelName, keypointFieldName]);\n\n  const saveAsKeypoints = async () => {\n    if (!keypointFieldName.trim()) {\n      alert(\"Please enter a field name\");\n      return;\n    }\n\n    const keypointCoords = clicks.map(click => [\n      click.normalizedX,\n      click.normalizedY,\n    ]);\n\n    const keypointLabels = clicks.map(click => [click.label]);\n\n    try {\n      await executeOperator(\n        \"@51labs/click_segmentation/save_keypoints\",\n        {\n          keypoints: keypointCoords,\n          keypoint_labels: keypointLabels,\n          kpts_field_name: keypointFieldName.trim(),\n          label_name: labelName.trim()\n        }\n      );\n    } catch (error) {\n      console.error(\"Error saving keypoints:\", error);\n      alert(`Failed: ${error.message}`);\n    } finally {\n      clearClicks();\n    }\n  };\n\n  const autoSegmentWithSingleKeypoint = async (clickData) => {\n    const keypointCoords = [[clickData.normalizedX, clickData.normalizedY]];\n    try {\n      alert(\"Segmentation in progress\");\n      await executeOperator(\n        \"@51labs/click_segmentation/save_keypoints\",\n        {\n          keypoints: keypointCoords,\n          kpts_field_name: keypointFieldName.trim(),\n          label_name: labelName.trim()\n        }\n      );\n      await executeOperator(\n        \"@51labs/click_segmentation/segment_with_prompts\",\n        {\n          prompt_field: keypointFieldName.trim(),\n          model_name: modelName.trim(),\n          label_field: segFieldName.trim()\n        }\n      );\n      setClicks([])\n    } catch (error) {\n      console.error(\"Error auto segmenting:\", error);\n      alert(`Failed: ${error.message}`);\n    } finally {\n      clearClicks();\n    }\n  };\n\n  const segmentWithKeypoints = async () => {\n    try {\n      if (!isSingleClick){\n        alert(\"Segmentation in progress\");\n      }\n      await executeOperator(\n        \"@51labs/click_segmentation/segment_with_prompts\",\n        {\n          prompt_field: keypointFieldName.trim(),\n          model_name: modelName.trim(),\n          label_field: segFieldName.trim()\n        }\n      );\n    } catch (error) {\n      console.error(\"Error saving keypoints:\", error);\n      alert(`Failed: ${error.message}`);\n    }\n  };\n\n  const showClickMarker = (x, y) => {\n    const marker = document.createElement('div');\n    marker.className = 'click-marker';\n    marker.style.position = 'fixed';\n    marker.style.left = `${x}px`;\n    marker.style.top = `${y}px`;\n    marker.style.width = '12px';\n    marker.style.height = '12px';\n    marker.style.borderRadius = '50%';\n    marker.style.backgroundColor = isNegativeClick ? '#1da10e' : '#ff4444';\n    marker.style.border = '3px solid white';\n    marker.style.transform = 'translate(-50%, -50%)';\n    marker.style.pointerEvents = 'none';\n    marker.style.zIndex = '99999';\n    marker.style.boxShadow = '0 0 10px rgba(255,0,0,0.8)';\n    \n    document.body.appendChild(marker);\n    markersRef.current.push(marker);\n  };\n\n  const clearAllMarkers = () => {\n    markersRef.current.forEach(marker => {\n      marker.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';\n      marker.style.opacity = '0';\n      marker.style.transform = 'translate(-50%, -50%) scale(0)';\n      setTimeout(() => {marker.remove();}, 300);\n    });\n    \n    markersRef.current = [];\n  };\n\n  const clearClicks = () => {\n    console.log(\"Clearing clicks and markers\");\n    setClicks([]);\n    clearAllMarkers();\n  };\n\n  return (\n    <div style={{ padding: \"20px\", display: \"flex\", flexDirection: \"column\", height: \"100%\" }}>\n      <div style={{ marginBottom: \"15px\" }}>\n        <h3 style={{ margin: 0 }}>Image segmentation via point prompts</h3>\n      </div>\n\n      {/* Capture toggle on/off*/}\n      <div style={{ \n        marginBottom: \"20px\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        padding: \"15px\",\n        backgroundColor: isCapturing ? \"#e3f2fd\" : \"#f5f5f5\",\n        borderRadius: \"8px\",\n        border: `2px solid ${isCapturing ? \"#2196F3\" : \"#ddd\"}`,\n        transition: \"all 0.3s ease\"\n      }}>\n        <label style={{ \n          display: \"flex\", \n          alignItems: \"center\", \n          gap: \"10px\", \n          cursor: \"pointer\" \n        }}>\n          <input \n            type=\"checkbox\"\n            checked={isCapturing}\n            onChange={(e) => setIsCapturing(e.target.checked)}\n            style={{ \n              width: \"20px\", \n              height: \"20px\", \n              cursor: \"pointer\" \n            }}\n          />\n          <span style={{ \n            fontWeight: \"bold\", \n            fontSize: \"15px\",\n            color: isCapturing ? \"#1976d2\" : \"#666\"\n          }}>\n            {isCapturing ? \"Capturing Clicks\" : \"Activate Click Capture\"}\n          </span>\n        </label>\n        {isCapturing && (\n          <p style={{ \n            fontSize: \"12px\", \n            color: \"#1976d2\", \n            margin: \"8px 0 0 30px\",\n            fontWeight: \"500\"\n          }}>\n            Click anywhere on the modal image to capture keypoints.\n          </p>\n        )}\n      </div>\n\n      {/* Keypoint field name input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\", \n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Sample field name for saving clicks (as keypoints)\n          </span>\n          <input \n            type=\"text\"\n            value={keypointFieldName}\n            onChange={(e) => setKeypointFieldName(e.target.value)}\n            placeholder=\"e.g., user_clicks, keypoints\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Keypoint label name input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\",\n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Label name for the current set of clicks\n          </span>\n          <input \n            type=\"text\"\n            value={labelName}\n            onChange={(e) => setLabelName(e.target.value)}\n            placeholder=\"e.g., animal, person\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Negative keypoint toggle on/off */}\n      <div style={{ \n        marginBottom: \"20px\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        padding: \"15px\",\n        backgroundColor: isNegativeClick ? \"#fdf0e3\" : \"#f5f5f5\",\n        borderRadius: \"8px\",\n        border: `2px solid ${isNegativeClick ? \"#f36b21\" : \"#ddd\"}`,\n        transition: \"all 0.3s ease\"\n      }}>\n        <label style={{ \n          display: \"flex\", \n          alignItems: \"center\", \n          gap: \"10px\", \n          cursor: \"pointer\",\n        }}>\n          <input \n            type=\"checkbox\"\n            checked={isNegativeClick}\n            onChange={(e) => {setSingleClick(false); setIsNegativeClick(e.target.checked);}}\n            disabled={!isCapturing}\n            style={{ \n              width: \"20px\", \n              height: \"20px\", \n              cursor: (isCapturing) ? \"pointer\" : \"not-allowed\",\n            }}\n          />\n          <span style={{ \n            fontWeight: \"bold\", \n            fontSize: \"15px\",\n            color: isNegativeClick ? \"#d26319\" : \"#666\"\n          }}>\n            {isNegativeClick ? \"Negative Clicks Enabled\" : \"Enable Negative Clicks\"}\n          </span>\n        </label>\n        {(isCapturing && isNegativeClick) && (\n          <p style={{ \n            fontSize: \"12px\", \n            color: \"#d26319\", \n            margin: \"8px 0 0 30px\",\n            fontWeight: \"500\"\n          }}>\n            Capturing negative keypoint prompts via clicks. Not supported for single click execution.\n          </p>\n        )}\n      </div>\n\n      {/* Keypoint buttons */}\n      <div style={{ marginBottom: \"10px\", display: \"flex\", gap: \"10px\" }}>\n      <button \n          onClick={saveAsKeypoints}\n          disabled={(isSingleClick) || (clicks.length === 0)}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: (!isSingleClick) && (clicks.length > 0) ? \"#2196F3\" : \"#ccc\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: (!isSingleClick) && (clicks.length > 0) ? \"pointer\" : \"not-allowed\",\n            fontWeight: \"bold\"\n          }}\n        >\n          Save as Keypoints ({clicks.length})\n        </button>\n        <button\n          onClick={clearClicks}\n          disabled={(isSingleClick) || (clicks.length === 0)}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: (!isSingleClick) || (clicks.length > 0) ? \"#2196F3\" : \"#ccc\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: (!isSingleClick) && (clicks.length > 0) ? \"pointer\" : \"not-allowed\",\n          }}\n        >\n          Clear Clicks ({clicks.length})\n        </button>\n      </div>\n\n      <hr style={{ \n        border: \"none\", \n        borderTop: \"1px solid #ddd\",\n        margin: \"20px 0\"\n      }} />\n\n      {/* Single click execution */}\n      <div style={{ \n        marginBottom: \"20px\",\n        display: \"flex\",\n        flexDirection: \"column\",\n        padding: \"15px\",\n        backgroundColor: isSingleClick ? \"#e3f2fd\" : \"#f5f5f5\",\n        borderRadius: \"8px\",\n        border: `2px solid ${isSingleClick ? \"#2196F3\" : \"#ddd\"}`,\n        transition: \"all 0.3s ease\"\n      }}>\n        <label style={{ \n          display: \"flex\", \n          alignItems: \"center\", \n          gap: \"10px\", \n          cursor: \"pointer\" \n        }}>\n          <input\n            type=\"checkbox\"\n            checked={isSingleClick}\n            onChange={(e) => {setSingleClick(e.target.checked); setIsNegativeClick(false);}}\n            disabled={!isCapturing}\n            style={{ \n              width: \"20px\", \n              height: \"20px\", \n              cursor: (isCapturing) ? \"pointer\" : \"not-allowed\",\n            }}\n          />\n          <span style={{ \n            fontWeight: \"bold\", \n            fontSize: \"15px\",\n            color: isSingleClick ? \"#1976d2\" : \"#666\"\n          }}>\n            {isSingleClick ? \"Single Click Segmentation\" : \"Enable Single Click Segmentation\"}\n          </span>\n        </label>\n        {isSingleClick && (\n          <p style={{ \n            fontSize: \"12px\", \n            color: \"#1976d2\", \n            margin: \"8px 0 0 30px\",\n            fontWeight: \"500\"\n          }}>\n            Single click segmentation is enabled. Clicking on the modal will auto-generate segmentation.\n          </p>\n        )}\n      </div>\n\n      {/* Model name input */}\n      <div style={{ \n        marginBottom: \"8px\", \n        padding: \"4px\",\n      }}>\n        <label style={{ \n          display: \"flex\", \n          flexDirection: \"column\", \n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Promptable segmentation model from FiftyOne model zoo\n          </span>\n          <input \n            type=\"text\"\n            value={modelName}\n            onChange={(e) => setModelName(e.target.value)}\n            placeholder=\"e.g., segment-anything-2-hiera-small-image-torch\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Segmentation field name input */}\n      <div style={{\n        marginBottom: \"8px\",\n        padding: \"4px\",\n      }}>\n        <label style={{\n          display: \"flex\",\n          flexDirection: \"column\",\n          gap: \"8px\",\n          fontSize: \"14px\"\n        }}>\n          <span style={{ fontSize: \"14px\", color: \"#666\" }}>\n            Sample field name for saving segmentation masks (optional)\n          </span>\n          <input \n            type=\"text\"\n            value={segFieldName}\n            onChange={(e) => setSegFieldName(e.target.value)}\n            placeholder=\"Defaults to keypoint_field_seg, e.g., user_clicks_seg\"\n            style={{\n              padding: \"8px 12px\",\n              border: \"1px solid #ccc\",\n              borderRadius: \"4px\",\n              fontSize: \"14px\",\n              fontFamily: \"monospace\"\n            }}\n          />\n        </label>\n      </div>\n\n      {/* Segment with keypoints button */}\n      <div style={{ marginBottom: \"10px\", display: \"flex\", gap: \"10px\" }}>\n        <button \n          onClick={segmentWithKeypoints}\n          disabled={isSingleClick}\n          style={{\n            padding: \"8px 16px\",\n            backgroundColor: (!isSingleClick) ? \"#2196F3\" : \"#ccc\",\n            color: \"white\",\n            border: \"none\",\n            borderRadius: \"4px\",\n            cursor: (!isSingleClick) ? \"pointer\" : \"not-allowed\",\n            fontWeight: \"bold\"\n          }}\n        >\n          Segment with keypoints\n        </button>\n      </div>\n    </div>\n  );\n}","import { PluginComponentType, registerComponent } from \"@fiftyone/plugins\";\nimport { ClickSegmentation } from \"./ClickSegmentation\";\n\nregisterComponent({\n  name: \"ClickSegmentation\",\n  label: \"Click To Segment\",\n  component: ClickSegmentation,\n  type: PluginComponentType.Panel,\n  activator: myActivator,\n  panelOptions: {\n    surfaces: \"modal\",\n  },\n});\n\nfunction myActivator({ dataset }) {\n  return true;\n}\n"],"names":["ClickSegmentation","modalSample","useRecoilValue","fos","clicks","setClicks","useState","isCapturing","setIsCapturing","isNegativeClick","setIsNegativeClick","isSingleClick","setSingleClick","keypointFieldName","setKeypointFieldName","segFieldName","setSegFieldName","modelName","setModelName","labelName","setLabelName","markersRef","useRef","useEffect","metadata","executeOperator","error","_a","handleCanvasClick","event","canvas","rect","imageAspect","canvasAspect","imgWidth","imgHeight","imgOffsetX","imgOffsetY","canvasX","canvasY","imgX","imgY","normalizedX","normalizedY","clickData","showClickMarker","autoSegmentWithSingleKeypoint","prev","saveAsKeypoints","keypointCoords","click","keypointLabels","clearClicks","segmentWithKeypoints","x","y","marker","clearAllMarkers","registerComponent","PluginComponentType","myActivator","dataset"],"mappings":"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"}